YUI.add("album-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.doOffline=!!this.appContext.flipper.isFlipped("enable-offline-downloadr"),this},subviewConfig:{"fluid-share-album-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name}},loadState:function(){var e=this;return e.appContext.getModel("set-models",e.albumId).then(function(t){e.set("albumModel",t)})},createBookFromAlbum:function(){this.appContext.flapp.navigate("/create")},buildContainer:function(){var e=this.get("container"),t=this.get("albumModel"),i=!1,n={};return"justified"===this.albumPhotoListLayoutStyle&&e.addClass("justified"),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===t.getValue("owner").id&&(i=!0),n.viewerIsOwner=i,n.enableDownload=!1,(this.appContext.flipper.isFlipped("enable-just-your-album-download")&&i||this.appContext.flipper.isFlipped("enable-album-download")&&t.getValue("canDownload"))&&(n.enableDownload=!0),this.subviews["fluid-share-album-view"]&&(n["fluid-share-album-view"]=this.subviews["fluid-share-album-view"].get("container"),(n.viewerIsOwner||n["enable-download"])&&n["fluid-share-album-view"].addClass("not-alone")),this.setContainerWithTemplate("album-engagement",n),this},buildErrorContainer:function(){},activate:function(){var t=this,i=this.get("container"),n=i.one(".create-book-container"),o=i.one(".download-album-container");return n&&t.registerEventHandler(n.on("click",function(){t.createBookFromAlbum()})),o&&(this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext,doOffline:this.doOffline}),t.registerEventHandler(o.on("click",t.downloadAlbum.bind(this)))),this},destructor:function(){this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},downloadAlbum:function(t){var i,n,o=this,a=this.get("albumModel");if(e.rapidTracker.beacon(this.name,"openDownloadAlbum"),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===a.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),this.doOffline){if(1===a.getValue("totalCount"))return a.getValue("photoPageList").getPage({page:1,perPage:1}).then(function(t){var i,n,o,a=t[0];a.getValue("isVideo")?n="/video_download.gne?id="+a.id:(i=(o=a.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),n="https:"+o.join(".")+"_d."+i),e.config.doc.location.href=n});if(a.getValue("totalCount")>e.config.flickr.downloadr.max_album_items)return e.rapidTracker.beacon(this.name,"albumDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:a.getValue("owner").getValue("displayname"),userurl:a.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+a.id}),this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),!0);i=o.bulkDownloaderView.createTitle(a.getValue("photoCount"),a.getValue("videoCount")),o.bulkDownloaderView.showDownloadDialog({doOffline:!0,title:i,setID:this.albumId})}else n=this.bulkDownloaderView.showLoadingDialog(),this.bulkDownloaderView.prepareArchive({set_id:this.albumId}).then(function(e){n.close(),o.bulkDownloaderView.showDownloadDialog(e)}).catch(function(e){n.close(),o.onError(e)})},onParentViewEvent:function(e,t){var i=this.get("container");return"album-engagement-view"===e&&"albumHeaderView:editing"===t[0]?(i.addClass("invisible"),!1):"album-engagement-view"===e&&"albumHeaderView:doneEditing"===t[0]?(i.removeClass("invisible"),!1):void 0},onError:function(t,i,n){var o;return o={appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),darkOverlay:!0},o[n?"htmlMessage":"message"]=t,this.errorDialog=new e.Views.FluidModal(o),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-engagement","hermes-template-flickr-balls"],optionalRequires:["bulk-downloader-view"],optional:["fluid-share-album-view"],langBundles:["common","album-page","downloadr"]});YUI.add("hermes-template-photo-list-photo-interaction",function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,a,l){var s;return n.escapeExpression(n.lambda(null!=(s=null!=t?t.photo:t)?s.title:s,t))},3:function(n,t,e,a,l){return n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:l}))},5:function(n,t,e,a,l){return" "+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.BY_YOU"},data:l}))},7:function(n,t,e,a,l){var s;return" "+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{user:null!=(s=null!=(s=null!=t?t.photo:t)?s.owner:s)?s.username:s,intlName:"common.BY_USER"},data:l}))},9:function(n,t,e,a,l){var s,o=null!=t?t:{};return'\t\t<div class="extra-tools">\n'+(null!=(s=e.if.call(o,null!=t?t.removeToolClass:t,{name:"if",hash:{},fn:n.program(10,l,0),inverse:n.noop,data:l}))?s:"")+(null!=(s=e.if.call(o,null!=t?t.bigScotchTitle:t,{name:"if",hash:{},fn:n.program(12,l,0),inverse:n.noop,data:l}))?s:"")+(null!=(s=e.if.call(o,null!=t?t.moreMenuItems:t,{name:"if",hash:{},fn:n.program(14,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t</div>\n"},10:function(n,t,e,a,l){var s,o,i=n.escapeExpression;return'\t\t\t\t<div class="extra-tool remove-photo '+i("function"==typeof(o=null!=(o=e.removeToolClass||(null!=t?t.removeToolClass:t))?o:e.helperMissing)?o.call(null!=t?t:{},{name:"removeToolClass",hash:{},data:l}):o)+'" data-id='+i(n.lambda(null!=(s=null!=t?t.photo:t)?s.id:s,t))+"></div>\n"},12:function(n,t,e,a,l){var s,o,i=n.escapeExpression;return'\t\t\t\t<div class="extra-tool big-scotch" data-id='+i(n.lambda(null!=(s=null!=t?t.photo:t)?s.id:s,t))+' title="'+i("function"==typeof(o=null!=(o=e.bigScotchTitle||(null!=t?t.bigScotchTitle:t))?o:e.helperMissing)?o.call(null!=t?t:{},{name:"bigScotchTitle",hash:{},data:l}):o)+'"></div>\n'},14:function(n,t,e,a,l){var s,o,i=null!=t?t:{},r=e.helperMissing,u=n.escapeExpression;return'\t\t\t\t<div class="extra-tool more-menu" data-menu-items="'+u("function"==typeof(o=null!=(o=e.moreMenuItems||(null!=t?t.moreMenuItems:t))?o:r)?o.call(i,{name:"moreMenuItems",hash:{},data:l}):o)+'" data-id='+u(n.lambda(null!=(s=null!=t?t.photo:t)?s.id:s,t))+' title="'+u((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.MORE"},data:l}))+'"></div>\n'},16:function(n,t,e,a,l){var s,o,i=n.escapeExpression;return'\t\t\t\t<a href="'+i("function"==typeof(o=null!=(o=e.photoPageUrl||(null!=t?t.photoPageUrl:t))?o:e.helperMissing)?o.call(null!=t?t:{},{name:"photoPageUrl",hash:{},data:l}):o)+'" class="title" tabindex="-1">'+i(n.lambda(null!=(s=null!=t?t.photo:t)?s.title:s,t))+"</a>\n"},18:function(n,t,e,a,l){return'\t\t\t\t<span class="title empty"> </span>\n'},20:function(n,t,e,a,l){var s;return'\t\t\t\t<a href="'+n.escapeExpression(n.lambda(null!=(s=null!=(s=null!=t?t.photo:t)?s.owner:s)?s.url:s,t))+'" class="attribution">\n'+(null!=(s=(e.photoAttribution||t&&t.photoAttribution||e.helperMissing).call(null!=t?t:{},null!=t?t.photo:t,null!=t?t.flippers:t,{name:"photoAttribution",hash:{},fn:n.program(21,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t\t\t</a>\n"},21:function(n,t,e,a,l){var s;return null!=(s=e.if.call(null!=t?t:{},null!=t?t.intlName:t,{name:"if",hash:{},fn:n.program(22,l,0),inverse:n.program(24,l,0),data:l}))?s:""},22:function(n,t,e,a,l){return"\t\t\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{user:null!=t?t.user:t,intlName:null!=t?t.intlName:t},data:l}))+"\n"},24:function(n,t,e,a,l){var s;return"\t\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(s=null!=(s=e.user||(null!=t?t.user:t))?s:e.helperMissing)?s.call(null!=t?t:{},{name:"user",hash:{},data:l}):s)+"\n"},26:function(n,t,e,a,l){return'\t\t\t\t<span class="attribution empty"> </span>\n'},28:function(n,t,e,a,l){return" faved"},30:function(n,t,e,a,l){return" can-not-fave"},32:function(n,t,e,a,l){return'\t\t\t\t\taria-label="'+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:l}))+'"\n'},34:function(n,t,e,a,l){return'\t\t\t\t\taria-label="'+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.ADD_TO_FAVORITES"},data:l}))+'"\n'},36:function(n,t,e,a,l){return'tabindex="-1"'},38:function(n,t,e,a,l){var s;return n.escapeExpression((e.formatNumber||t&&t.formatNumber||e.helperMissing).call(null!=t?t:{},null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.faveCount:s,{name:"formatNumber",hash:{},data:l}))},40:function(n,t,e,a,l){return" hidden"},42:function(n,t,e,a,l){var s;return n.escapeExpression((e.formatNumber||t&&t.formatNumber||e.helperMissing).call(null!=t?t:{},null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.commentCount:s,{name:"formatNumber",hash:{},data:l}))},44:function(n,t,e,a,l){return'\t\t\t\t<span role="button" class="engagement-item curate" tabindex="0">\n\t\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t\t<svg class="icon icon-curate"><use xlink:href="#icon-curate"></use></svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n'},compiler:[7,">= 4.0.0"],main:function(n,t,e,a,l){var s,o,i=null!=t?t:{},r=e.helperMissing,u=n.escapeExpression;return'<div class="photo-list-photo-interaction">\n\t<a class="overlay" href="'+u("function"==typeof(o=null!=(o=e.photoPageUrl||(null!=t?t.photoPageUrl:t))?o:r)?o.call(i,{name:"photoPageUrl",hash:{},data:l}):o)+'" tabindex="0" role="heading" aria-level="3" aria-label="'+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.title:s,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(3,l,0),data:l}))?s:"")+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.isOwner:s,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.program(7,l,0),data:l}))?s:"")+'"></a>\n'+(null!=(s=e.if.call(i,null!=t?t.hasExtraFunctionality:t,{name:"if",hash:{},fn:n.program(9,l,0),inverse:n.noop,data:l}))?s:"")+'\t<div class="interaction-bar" title="'+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.title:s,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(3,l,0),data:l}))?s:"")+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.isOwner:s,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.program(7,l,0),data:l}))?s:"")+'">\n\t\t<div class="text">\n'+(null!=(s=e.if.call(i,null!=(s=null!=t?t.photo:t)?s.title:s,{name:"if",hash:{},fn:n.program(16,l,0),inverse:n.program(18,l,0),data:l}))?s:"")+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.owner:s)?s.displayname:s,{name:"if",hash:{},fn:n.program(20,l,0),inverse:n.program(26,l,0),data:l}))?s:"")+'\t\t</div>\n\n\t\t<div class="engagement">\n\t\t\t\n\t\t\t<span role="button" class="engagement-item fave '+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.isFaved:s,{name:"if",hash:{},fn:n.program(28,l,0),inverse:n.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=t?t.canFave:t,{name:"if",hash:{},fn:n.noop,inverse:n.program(30,l,0),data:l}))?s:"")+'" tabindex="0"\n'+(null!=(s=e.if.call(i,null!=t?t.isFaved:t,{name:"if",hash:{},fn:n.program(32,l,0),inverse:n.program(34,l,0),data:l}))?s:"")+"\t\t\t\t"+(null!=(s=e.unless.call(i,null!=t?t.canFave:t,{name:"unless",hash:{},fn:n.program(36,l,0),inverse:n.noop,data:l}))?s:"")+'>\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n\t\t\t\t\t<svg class="icon icon-fave filled"><use xlink:href="#icon-fave"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count">\n\t\t\t\t\t'+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.faveCount:s,{name:"if",hash:{},fn:n.program(38,l,0),inverse:n.noop,data:l}))?s:"")+'\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<a class="engagement-item comment" href="'+u("function"==typeof(o=null!=(o=e.photoPageUrl||(null!=t?t.photoPageUrl:t))?o:r)?o.call(i,{name:"photoPageUrl",hash:{},data:l}):o)+'#comments" aria-label="'+u((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_COMMENT"},data:l}))+'" tabindex="0">\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count'+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.commentCount:s,{name:"if",hash:{},fn:n.noop,inverse:n.program(40,l,0),data:l}))?s:"")+'">\n\t\t\t\t\t'+(null!=(s=e.if.call(i,null!=(s=null!=(s=null!=t?t.photo:t)?s.engagement:s)?s.commentCount:s,{name:"if",hash:{},fn:n.program(42,l,0),inverse:n.noop,data:l}))?s:"")+"\n\t\t\t\t</span>\n\t\t\t</a>\n\n"+(null!=(s=e.if.call(i,null!=t?t.displayCurate:t,{name:"if",hash:{},fn:n.program(44,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t</div>\n\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(t){var e=n.Template.get("hermes/"+t);e&&(a[t]=e)}),n.Template.register("hermes/photo-list-photo-interaction",function(t,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,e(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-add-to-stuff-view",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item album-tab selected" data-tab="album" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.ALBUMS"},data:l}))+"</span>\n\t\t\t\t</li>\n"},3:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item gallery-tab" data-tab="gallery" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:l}))+"</span>\n\t\t\t\t</li>\n"},5:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item group-tab" data-tab="group" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GROUPS"},data:l}))+"</span>\n\t\t\t\t</li>\n"},7:function(t,a,e,n,l){var s=null!=a?a:{},i=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="tab-container selected" data-tab="album">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["album-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["album-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t</div>\n"},9:function(t,a,e,n,l){var s=null!=a?a:{},i=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="tab-container" data-tab="gallery">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["gallery-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["gallery-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t</div>\n"},11:function(t,a,e,n,l){var s,i=null!=a?a:{};return'\t\t\t<div class="tab-container" data-tab="group">\n\t\t\t\t'+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(i,null!=a?a["group-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"+(null!=(s=e.if.call(i,null!=a?a.inlineGroupCreation:a,{name:"if",hash:{},fn:t.program(12,l,0),inverse:t.noop,data:l}))?s:"")+"\t\t\t</div>\n"},12:function(t,a,e,n,l){return"\t\t\t\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["group-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"},compiler:[7,">= 4.0.0"],main:function(t,a,e,n,l){var s,i=null!=a?a:{},o=e.helperMissing,r=t.escapeExpression;return'<div class="add-to-stuff-container" tabindex="-1">\n\t<div class="nav">\n\t\t<div class="list-label">'+r((e.intlMessage||a&&a.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"add-to-stuff.ADD_TO_LABEL"},data:l}))+"</div>\n\t\t<ul>\n"+(null!=(s=e.if.call(i,null!=a?a.showAlbums:a,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=a?a.showGalleries:a,{name:"if",hash:{},fn:t.program(3,l,0),inverse:t.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=a?a.showGroups:a,{name:"if",hash:{},fn:t.program(5,l,0),inverse:t.noop,data:l}))?s:"")+'\t\t</ul>\n\t\t<a href="/groups/2641619@N21/discuss/72157687179936855/" target="_blank" class="alpha-link">\n\t\t\t<span class="label-beta">'+r((e.intlMessage||a&&a.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.ALPHA"},data:l}))+'</span>\n\t\t</a>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</div>\n\t<div class="tab-content-container">\n\n'+(null!=(s=e.if.call(i,null!=a?a.showAlbums:a,{name:"if",hash:{},fn:t.program(7,l,0),inverse:t.noop,data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=a?a.showGalleries:a,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.noop,data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=a?a.showGroups:a,{name:"if",hash:{},fn:t.program(11,l,0),inverse:t.noop,data:l}))?s:"")+"\t</div>\n</div>\n"},useData:!0}),n={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)}),t.Template.register("hermes/add-to-stuff-view",function(a,l){return l=l||{},l.partials=l.partials?t.merge(n,l.partials):n,e(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("add-to-stuff-view",function(e){e.namespace("Views")[this.name]=e.Base.create("add-to-stuff-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.params.showAlbums=!1!==this.params.showAlbums,this.params.showGalleries=!1!==this.params.showGalleries,this.params.showGroups=!1!==this.params.showGroups,this.params.initialTab=this.params.initialTab||"album",this.initialTab=this.params.initialTab,this.params.inlineGroupCreation=this.params.inlineGroupCreation||!1,this.currentTabName="",this},subviewConfig:{"album-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"gallery-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"group-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"album-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]},"gallery-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]},"group-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]}},buildContainer:function(){return this.setContainerWithTemplate("add-to-stuff-view",{showAlbums:this.params.showAlbums,showGalleries:this.params.showGalleries,showGroups:this.params.showGroups,inlineGroupCreation:this.params.inlineGroupCreation}),this},activate:function(){var t=this.get("container");return this.nav=t.one(".nav"),this.doneButton=t.one(".done-button"),this.createButton=t.one(".create-button"),this.firstTab=t.one(".tab-item"),this.registerEventHandler(this.nav.one("ul").on(["click","key"],this.handleNavClick.bind(this),"down:13")),this.registerEventHandler(this.nav.one(".close-x-button").on("click",this.handleCloseClick.bind(this))),this.registerEventHandler(e.on("addToStuff:hideNav",function(e){this.nav.hide()}.bind(this))),this.registerEventHandler(e.on("addToStuff:showNav",function(e){this.nav.show()}.bind(this))),this.registerEventHandler(e.on("addToStuff:showCreate",function(t){e.one("."+t.type+"-selection-view").addClass("hidden"),e.one("."+t.type+"-creation-view").removeClass("hidden"),this.nav.hide(),e.fire("addToStuff:createShown",{curationType:this.currentTabName}),e.fire("addToStuff:reposition")}.bind(this))),this.registerEventHandler(e.on("addToStuff:hideCreate",function(t){e.one("."+t.type+"-selection-view").removeClass("hidden"),e.one("."+t.type+"-creation-view").addClass("hidden"),this.nav.show(),e.fire("addToStuff:createHidden",{curationType:this.currentTabName}),e.fire("addToStuff:reposition")}.bind(this))),this.switchTabs(this.initialTab),this.registerEventHandler(t.on("keydown",this.handleKeyPress.bind(this))),this.registerEventHandler(t.delegate("focus",this.handleFocus.bind(this))),this},handleNavClick:function(e){var t;e.stopPropagation(),e.preventDefault(),e.target&&(t=e.target.ancestor("li",!0))&&this.switchTabs(t.get("dataset").tab)},switchTabs:function(t){var i=this.nav.one(".tab-item.selected"),n=this.nav.one(".tab-item[data-tab="+t+"]"),a=i?i.get("dataset").tab:null,r=this.get("container").one(".tab-content-container"),s=r.one(".tab-container[data-tab="+a+"]"),o=r.one(".tab-container[data-tab="+t+"]"),l=o.one(".stuff-selection-search");this.currentTabName=t,i&&(i.removeClass("selected"),s.removeClass("selected")),n.addClass("selected"),o.addClass("selected"),setTimeout(function(){l.focus()},0),e.fire("addToStuff:reposition")},handleCloseClick:function(t){e.fire("addToStuff:close")},handleKeyPress:function(t){var i=t.keyCode,n=t.shiftKey,a=this.doneButton||this.createButton;9===i&&(n&&this.focusedItem===this.firstTab?(t.preventDefault(),a.focus()):n||this.focusedItem!==a||(t.preventDefault(),this.firstTab.focus())),e.fire("addToStuff:keyPressed",{curationType:this.currentTabName,evt:t})},handleFocus:function(e){this.focusedItem=e.target}},{ATTRS:{dismissOnCreate:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateAlbum:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateGallery:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateGroup:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelect:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectAlbum:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectGallery:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectGroup:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},inlineGroupCreation:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},useLargeLayout:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-add-to-stuff-view"],langBundles:["common","more-menu-view","add-to-stuff"]});YUI.add("hermes-lang-more-menu-view",function(e,o){e.Intl.add("hermes/more-menu-view","en-US",{ADD_TO_ALBUM:["Add to album"],ADD_TO_SET:["Add to set"],ADD_TO_GROUP:["Add to group"],INVITE_TO_GROUP:["Invite to group"],ADD_TO_GALLERY:["Add to Gallery"],ADD_TO_REMOVE_FROM_ALBUM:["Add to / remove from album"],ADD_TO_REMOVE_FROM_SET:["Add to / remove from set"],ADD_TO_REMOVE_FROM_GALLERY:["Add to / remove from gallery"],ADD_TO_REMOVE_FROM_GROUP:["Add to / remove from group"],INVITE_TO_REMOVE_FROM_GROUP:["Invite to / remove from group"],FLAG_PHOTO:["Flag this Photo?"],FLAG:["Flag photo"],MARK_FOR_REVIEW:["Mark for review"],PHOTO_HAS_BEEN_FLAGGED:["This photo has been flagged"],PROBLEM_FLAGGING:["There was a problem flagging this photo"],ADD_PHOTO_TO_GROUP:["Add this photo to a group"],INVITE_PHOTO_TO_GROUP:["Invite this photo to a group"],ADD_PHOTO_TO_GALLERY:["Add this photo to a gallery"],ADD_PHOTO_TO_ALBUM:["Add photo to an album"],ADD_PHOTO_TO_SET:["Add photo to a set"],NO_GROUPS:["You're not in any groups! <a href='//www.flickr.com/groups'>Why not join one</a>?"],NO_GROUPS2:["You're not in any groups! <a href='","${url}","'>Why not join one</a>?"],NO_GROUPS_ADMIN:["You're not an admin of any groups! <a href='//www.flickr.com/groups_create.gne'>Why not create one</a>?"],NO_GROUPS_ADMIN2:["You're not an admin of any groups! <a href='","${url}","'>Why not create one</a>?"],NO_GALLERIES:["No galleries"],NO_ALBUMS:["No albums"],NO_SETS:["No sets"],LOADING_GROUPS:["Loading groups..."],LOADING_GALLERIES:["Loading galleries..."],LOADING_ALBUMS:["Loading albums..."],LOADING_SETS:["Loading sets..."],SEARCH_GROUPS_PLACEHOLDER:["search groups"],SEARCH_GALLERIES_PLACEHOLDER:["search galleries"],SEARCH_ALBUMS_PLACEHOLDER:["search albums"],SEARCH_SETS_PLACEHOLDER:["search sets"],GALLERY_TITLE_PLACEHOLDER:["gallery title (required)"],GALLERY_DESCRIPTION_PLACEHOLDER:["gallery description"],ALBUM_TITLE_PLACEHOLDER:["Album title"],SET_TITLE_PLACEHOLDER:["Set title"],DESCRIPTION_PLACEHOLDER:["Description (optional)"],CREATE_NEW_GALLERY:["Create a new gallery"],CREATE_NEW_ALBUM:["Create new album"],CREATE_NEW_SET:["Create new set"],CREATE_GALLERY:["Create gallery"],CREATE_SET:["Create set"],CREATE_ALBUM:["Create album"],BACK_TO_GALLERIES:["Back to current galleries"],BACK_TO_ALBUMS:["Back to current albums"],BACK_TO_SETS:["Back to current sets"],GROUP_PRIVACY_WARNING:["This photo is private. If you add it to a group, the members of that group will be able to view, comment on, tag and add notes to it."],DONT_SHOW_ME_AGAIN:["Don't show me this message again"],DELETE_PHOTO:["Delete Photo"],PERMANENTLY_DELETE_PHOTO:["Permanently Delete This Photo"],PROBLEM_DELETING:["There was a problem deleting this photo"],ADD_LOCATION:["Add Location"],ADD_PEOPLE:["Add people"],DOWNLOAD_ALL_SIZES:["Download / All sizes"],EDIT_DATES:["Edit dates"],EDIT_TITLE_TAGS_DATES:["Edit title, tags, and dates"],ROTATE:["Rotate"],REPLACE:["Replace"],VIDEOS_NO_EDIT_IN_AVIARY:["Videos cannot be edited in Aviary"],EDIT_IN_AVIARY:["Edit in Aviary"],COMMENTING:["Commenting"],REPORT_ABUSE:["Report abuse"],FEEDBACK:["Feedback"],PEOPLE_TAGGING:["People tagging!"],OPEN_IN_ORGANIZER:["Open In Organizr"],MORE_ACTIONS:["More Actions"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-add-to-stuff",function(_,e){_.Intl.add("hermes/add-to-stuff","en-US",{ADD_TO_LABEL:["Add to:"],NO_RESULTS:["No results :("],NO_GROUPS:["No groups"],DONT_ADMIN_ANY_GROUPS:["You don’t admin any groups."],LEARN_TO_RUN_GROUP:["Learn how to run a group"],HAVENT_JOINED_ANY_GROUPS:["You haven’t joined any groups."],DISCOVER_GROUPS:["Discover groups"],PENDING_APPROVAL:["Pending approval"],CURATIONS_CREATE_NEW_GROUP:["Create new group"],CURATIONS_CREATE_A_NEW_GROUP:["Create a new group"],CURATIONS_CREATE_NEW_ALBUM:["Create new album"],CURATIONS_CREATE_A_NEW_ALBUM:["Create a new album"],CURATIONS_CREATE_NEW_GALLERY:["Create new gallery"],CURATIONS_CREATE_A_NEW_GALLERY:["Create a new gallery"],ABOUT_YOUR_GROUP:["About your group"],COULDNT_ADD_TO_GROUP:["Couldn’t add to group."],COULDNT_ACCEPT_GROUP_INVITE:["Couldn’t accept invitation to group."],COULDNT_INVITE_TO_GROUP:["Couldn’t invite to group."],COULDNT_CANCEL_GROUP_INVITE:["Couldn’t cancel group invitation."],COULDNT_REMOVE_FROM_GROUP:["Couldn’t remove from group"],APPROVE:["Approve"],CURATIONS_ALBUM_NAME:["Album name"],CURATIONS_GALLERY_NAME:["Gallery name"],CURATIONS_DESCRIPTION_OPTIONAL:["Description (optional)"],PLEASE_ENTER_GROUP_NAME:["Please enter a group name."],PLEASE_ENTER_ALBUM_NAME:["Please enter an album name."],PLEASE_ENTER_GALLERY_NAME:["Please enter a gallery name."],COULDNT_SAVE_GROUP:["Couldn’t save group. Please try again."],COULDNT_SAVE_ALBUM:["Couldn’t save album. Please try again."],COULDNT_SAVE_GALLERY:["Couldn’t save gallery. Please try again."],GROUP_PRIVATE_PHOTO_WARNING:["This photo is private. If you add it to a group, the members of that group will be able to view, comment on, tag, and add notes to it."],CONFIRM_GROUP_PRIVATE_PHOTO_ADD:["Ok, add to groups anyway"],DONT_SHOW_MESSAGE_AGAIN:["Don’t show me this message again"],COULDNT_ADD_TO_GROUP_TOO_MANY:["Photo in maximum number of groups"],COULDNT_ADD_TO_GROUP_TOO_MANY_NON_PRO:["Photo in maximum number of groups for non-pro account"]})},"@VERSION@",{requires:["intl"]});YUI.add("photo-list-photo-interaction-view",function(e,t){var i=require("hermes-core/type-validator"),n=require("hermes-core/flog")(t),o={css:{faveClickArea:".fave-area",commentClickArea:".comment-area",removeFaveTool:"remove-fave",removePoolTool:"remove-group-pool",removeShowCasePhoto:"remove-showcase-photo",removePhotosOfYou:"remove-photosof-you",scotchTool:"scotch-photo"}};e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=this.appContext.getViewer();return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),t.signedIn&&e.nsid===t.nsid||this.set("viewingSelf",!1),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),this.params=e,this.signedIn=t.signedIn,this},loadState:function(){var t=[],i=this.get("listModelParams");return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),i&&t.push(this.appContext.getModel(i.registryName,i.modelIdOrAttributes)),e.Promise.all(t).then(function(e){var t=e[0],i=e[1];this.set("engagement",t),this.extraFunctionality={moreMenuItems:[]},this.params.removeOwnFaves?this.get("model").getValue("isOwner")&&!this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=o.css.removeFaveTool):this.params.removePoolPhoto?this.get("model").getValue("isOwner")?this.extraFunctionality.removeToolClass=o.css.removePoolTool:i&&(i.getValue("group").getValue("isAdmin")||i.getValue("group").getValue("isModerator"))&&(this.extraFunctionality.removeToolClass=o.css.removePoolTool):this.params.scotch?this.extraFunctionality.removeToolClass=o.css.scotchTool:this.params.removeShowCasePhoto?this.get("model").getValue("isOwner")&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=o.css.removeShowCasePhoto):this.params.removePhotosOfYou&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=o.css.removePhotosOfYou),this.params.excludePeople&&this.extraFunctionality.moreMenuItems.push("exclude-people"),this.params.banUser&&i&&(i.getValue("group").getValue("isAdmin")||i.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("ban-user"),this.params.removeUser&&i&&(i.getValue("group").getValue("isAdmin")||i.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("remove-user"),this.params.searchSimilar&&this.extraFunctionality.moreMenuItems.push("search-similar"),this.params.searchSimilarWithTerm&&this.extraFunctionality.moreMenuItems.push("search-similar-with-term"),this.params.bigScotch&&(this.extraFunctionality.bigScotchTitle=this.godMessage({intlName:"explore.DO_BIG_SCOTCH"})),this.extraFunctionality.moreMenuItems=this.extraFunctionality.moreMenuItems.join(",")}.bind(this))},buildContainer:function(t){var i=this.get("engagement"),n=i.getValue("faveCount"),o=i.getValue("isFaved"),a=i.getValue("canFave"),s=i.getValue("commentCount");return t=t||{},n=e.IntlNumber.format(n,this.appContext.lang,1),s=e.IntlNumber.format(s,this.appContext.lang,1),t.photo=this.get("model").toJSON(),t.photoPageUrl=this.get("photoPageUrl"),t.faveCount=n,t.isFaved=o,t.canFave=a,t.commentCount=s,t.displayCurate=this.appContext.flipper.isFlipped("enable-megadroparound")&&this.signedIn,t.hasExtraFunctionality=Object.keys(this.extraFunctionality).length>0,t.removeToolClass=this.extraFunctionality.removeToolClass,t.moreMenuItems=this.extraFunctionality.moreMenuItems,t.bigScotchTitle=this.extraFunctionality.bigScotchTitle,this.setContainerWithTemplate("photo-list-photo-interaction",t),this},activate:function(){var t=this.appContext.getViewer(),i=this.get("engagement"),n=this.get("container");return this.infoBar=n.one(".interaction-bar"),this.detailsNode=this.infoBar.one(".text"),this.infoBarEngagement=this.infoBar.one(".engagement"),this.faveNode=this.infoBarEngagement.one(".engagement-item.fave"),this.commentNode=this.infoBarEngagement.one(".engagement-item.comment"),this.appContext.flipper.isFlipped("enable-megadroparound")&&(this.curateNode=this.infoBar.one(".engagement-item.curate"),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","keydown"],this.handleCurateClick.bind(this)))),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count"),this.registerEventHandler(this.faveNode.on(["click","keydown"],this.handleFaveClick.bind(this))),this.registerEventHandler(i.on("valuesChanged",this.handleFaveChange.bind(this)))),this.commentNode&&(!this.signedOutTest||t&&t.signedIn||this.registerEventHandler(this.commentNode.on(["click","keydown"],this.handleCommentClick.bind(this)))),this.registerEventHandler(e.on("resize",e.betterThrottle(this.updateBreakpoints.bind(this),500,this,!0))),this.updateBreakpoints(),this},handleFaveClick:function(e){var t,i,o,a,s;if("click"===e.type||13===e.keyCode||32===e.keyCode){if(t=this,i=e.currentTarget,o=i.one(".engagement-count"),s=this.appContext.getViewer(),e.halt(),this.faveNode.hasClass("can-not-fave"))return;if(!this.signedIn)return void this.showSignUpAndFaveModal();this.isFaving||(this.isFaving=!0,this.get("engagement").toggleFave(),a=this.get("engagement").getValue("faveCount"),i.toggleClass("faved",this.get("engagement").getValue("isFaved")),o.toggleClass("empty",0===a),o&&a>0?o.set("text",a):o.set("text",""),this.get("engagement").remoteUpdate().then(function(){this.appContext.getModelRegistry("favorite-models").then(function(e){e.proxy(s.nsid).getValue("photoPageList").remove(t.get("model"))}),this.isFaving=!1}.bind(this),function(e){3!==e.code&&(this.get("engagement").toggleFave(),i.toggleClass("faved",this.get("engagement").getValue("isFaved")),o&&(o.set("text",a),o.toggleClass("empty",0===a))),n.error("Error faving photo",{err:e}),this.isFaving=!1}.bind(this)))}},handleCommentClick:function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||this.signedIn||(e.halt(),this.showSignUpAndCommentModal())},showSignUpAndFaveModal:function(){var t,i=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),n=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),o=this.get("engagement"),a=o.getValue("id"),s=e.url(e.URLHelper.getPhotoPage({photoId:a,pathAlias:o.getValue("ownerNsid")}));(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:i,signUpMessage:n,beaconPrefix:"fave"})).on("signUpClick",function(t){e.SigninHelper.signUpPendingFave({id:a},{postLoginUrl:s})}),t.on("signInClick",function(t){e.SigninHelper.addPendingFave({id:a},{postLoginUrl:s})}),t.show()},showSignUpAndCommentModal:function(){var t,i,n=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),o=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"}),a=this.get("engagement");e.rapidTracker.beacon(this.name,"commentIconClick"),i=e.url(e.URLHelper.getPhotoPage({photoId:a.getValue("id"),pathAlias:a.getValue("ownerNsid")})),(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-comment",signUpTitle:n,signUpMessage:o,beaconPrefix:"comment"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("comment",{postLoginUrl:i})}),t.on("signInClick",function(t){e.SigninHelper._redirectToSignin("comment",{postLoginUrl:i})}),t.show()},handleFaveChange:function(e){void 0===e.faveCount&&void 0===e.isFaved&&void 0===e.canFave||this.updateBreakpoints()},handleCurateClick:function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(e.halt(),this.showAddToCuration())},showAddToCuration:function(){var t=this.get("model").getValue("isOwner"),i=new e.Views["add-to-stuff-view"]({photoId:this.get("id"),initialTab:t?"album":"gallery",showAlbums:t,showGalleries:!t,inlineGroupCreation:!1,dismissOnSelect:!0,dismissOnCreate:!0});this.curateDroparound=new e.Views.FluidDroparound({appContext:this.appContext,subview:i,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,anchorOffsetHorizontal:12,anchorElement:this.curateNode,keyboardAnchorElement:this.curateNode,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),this.curateDroparound.show(),this.fire("curateOpened"),this.registerEventHandler(e.on("addToStuff:close",function(e){this.curateDroparound.close(e)}.bind(this))),this.registerEventHandler(this.curateDroparound.on("closeDroparound",function(e){this.fire("curateClosed")}.bind(this)))},updateBreakpoints:function(){var e=0;0!==this.infoBar.get("clientWidth")&&(this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.curateNode&&this.curateNode.removeClass("hidden"),this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.detailsNode.get("clientWidth")<=10&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+24&&(this.commentNode.addClass("hidden"),this.curateNode?e=this.curateNode.get("clientWidth"):this.faveNode.addClass("last"),this.faveCountNode&&this.infoBar.get("clientWidth")<e+this.faveNode.get("clientWidth")+24&&this.faveCountNode.addClass("hidden"),this.curateNode&&this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+24&&(this.curateNode.addClass("hidden"),this.faveNode.addClass("last"))),this.infoBar.removeClass("invisible"))},destructor:function(){}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return i.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},viewingSelf:{value:!0},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},layoutWidth:{validator:function(t,i){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||void 0},defaultFn:function(e){return 0}},isFaving:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-interaction","attribute-helpers","fluid-modal-view","fluid-droparound-view","add-to-stuff-view","url","intl-number"],optionalRequires:["fluid"],langBundles:["fave-view","common","photo-page-scrappy"]});YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});YUI.add("attribution-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.hideFollowView}}},initializer:function(e){return this.nsid=e.nsid,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.realFullscreen=!!e.realFullscreen,this.hideFollowView=!!e.hideFollowView&&e.hideFollowView,this.isAlbumView=e.isAlbumView,this},loadState:function(){var i=this;return e.Promise.all([i.appContext.getModel("person-models",i.nsid)]).then(function(e){i.set("owner",e[0])})},buildContainer:function(){var e,i=this.get("owner"),t=this.get("container"),l=i.getValue("pathAlias")||i.getValue("nsid");return"justified"===this.albumPhotoListLayoutStyle&&t.addClass("justified-album-details-page"),e=i.getValue("buddyicon").large?i.getValue("buddyicon").large:i.getValue("buddyicon").default,this.setContainerWithTemplate("attribution",{isPro:!!this.appContext.flipper.isFlipped("enable-pro-badge")&&i.getValue("isPro"),pathAlias:l,buddyicon:e,nsid:i.getValue("nsid"),displayname:i.getValue("displayname"),realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode(),isAlbumView:this.isAlbumView}),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-attribution","promise","follow-view"],optional:["person-models"],langBundles:["attribution"]});YUI.add("album-header-view",function(e,t){var i=require("hermes-core/flog")(t),a={css:{headerContent:".album-header-content"}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"album-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-stats-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,hideFollowView:!0,additionalViewClasses:["album-attribution"],isAlbumView:!0}},loadState:function(){var t=this,i=[];return i.push(this.appContext.getModel("set-models",this.albumId)),this.appContext.getViewer().signedIn&&i.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid)),e.Promise.all(i).then(function(e){t.set("albumModel",e[0]),e[1]&&t.set("personPreferenceModel",e[1])})},buildContainer:function(){var e,t=this.get("container"),a=this.getAlbumHeaderHeight()-60,n=this.get("albumModel"),o=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===n.getValue("owner").id,s=this.appContext.viewportData.getDevicePixelRatio();return"justified"===this.albumPhotoListLayoutStyle&&(t.addClass("justified-transitions"),t.addClass("justified"),a=300),(e=n.registry.getSizeToFit(this.albumId,{width:.8*this.appContext.viewportData.getWidth()*s,height:a*s}))||i.error("Failed to load album coverphoto."),this.setContainerWithTemplate("album-header",{height:a,"cover-photo-url":e?e.url:"",viewerIsOwner:o}),this},buildErrorContainer:function(){},activate:function(){var t,i=this,n=this.get("container"),o=n.one(".edit-cover-photo"),s=n.one(".album-header-content"),l=n.one(".avatar"),r=this.get("personPreferenceModel");if(this.albumHeaderElement=this.get("container").one(a.css.headerContent),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.resizeHeader.bind(this))),o&&this.registerEventHandler(o.on("click",this.handleSetCoverPhotoClick.bind(this))),this.appContext.flipper.isFlipped("enable-change-album-sorting")){var d=this.get("container").one(".change-album-sorting");d&&this.registerEventHandler(d.on("click",this.handleChangeAlbumSorting.bind(this)))}e.on("albumToolbarView:layoutChange",function(a){r&&(r.setValues({albumViewLayoutPref:a}),r.remoteUpdate()),"justified"===a?(n.addClass("justified-transitions"),n.addClass("justified"),s.setStyle("height",300),l&&e.flutil.onTransitionEnd(l,function(){n.one(".album-attribution").addClass("justified-album-details-page")})):(t=i.getAlbumHeaderHeight()-60+"px",s.setStyle("height",t),n.removeClass("justified"),l&&setTimeout(function(){n.one(".album-attribution").removeClass("justified-album-details-page")},250),e.flutil.onTransitionEnd(s,function(){n.removeClass("justified-transitions")}))})},onSubviewEvent:function(e,t){var i=this.get("container"),a=i.one(".album-header-content"),n=i.one(".edit-cover-photo");return"album-title-desc-view"===e&&"albumTitleDesc:editing"===t[0]?(this.fire("parentViewEvent","albumHeaderView:editing"),n.addClass("hidden"),!1):"album-title-desc-view"===e&&"albumTitleDesc:doneEditing"===t[0]?(this.fire("parentViewEvent","albumHeaderView:doneEditing"),n.removeClass("hidden"),!1):void("album-title-desc-view"===e&&"albumTitleDescEditing:heightChange"===t[0]&&t[1]&&a.setStyle("height",parseInt(a.getComputedStyle("height"),10)+t[1]+"px"))},resizeHeader:function(e){var t=this.getAlbumHeaderHeight()-60;this.get("container").hasClass("justified")||this.albumHeaderElement.setStyle("height",t)},getAlbumHeaderHeight:function(){var e,t=this.appContext.viewportData.getWidth(),i=this.appContext.viewportData.getHeight()-50,a=t/2.3+120,n=t/2.75;return e=i>t/1.3+120?t/1.3:i>a?i-120:i>n?i-120+120*(i-a)/(n-a):i,Math.max(480,Math.round(e))},handleChangeAlbumSorting:function(t){if(this.appContext.flipper.isFlipped("enable-change-album-sorting")){t.halt();var i=this;this.sortingOptionsDialog=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target,minVerticalSpace:250,positionFixed:!0,anchorOffsetHorizontal:14,menuItems:[{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_NEWEST"}),value:"date-posted-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_OLDEST"}),value:"date-posted-desc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_OLDEST"}),value:"date-taken-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_NEWEST"}),value:"date-taken-desc"},{text:this.intlMessage({intlName:"album-page.SORT_ALPHABETICALLY"}),value:"title"},{text:this.intlMessage({intlName:"album-page.SORT_RANDOMLY"}),value:"random"},{text:this.intlMessage({intlName:"album-page.SORT_REVERSE"}),value:"reverse"}]}),this.registerEventHandler(this.sortingOptionsDialog.on("selected",function(t){if(t.preventDefault(),i.sortingOptionsDialog.close(),t.menuItem&&t.menuItem.value){var a={photoset_id:i.get("albumModel").getValue("id"),sort:t.menuItem.value,preview:0};i.loadingModal=new e.Views.FluidModal({appContext:this.appContext,title:i.intlMessage({intlName:"common.LOADING"}),message:i.intlMessage({intlName:"album-page.SORT_ALMOST_DONE"}),showButtons:!1}),i.loadingModal.show(),i.appContext.callAPI("flickr.photosets.sortPhotos",a).then(i.onAlbumSortingChanged.bind(i)).catch(i.onAlbumSortingFailed.bind(i))}})),this.sortingOptionsDialog.show()}},onAlbumSortingChanged:function(t){"ok"===t.stat?e.config.win.location.reload():this.onAlbumSortingFailed(t)},onAlbumSortingFailed:function(t){if("fail"===t.stat){new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:"Error while changing sort",actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()}},handleSetCoverPhotoClick:function(t){t.preventDefault();var i,a,n,o=this.get("container"),s=this,l=this.get("albumModel"),r=this.templates("flickr-balls")({}),d=o.one(".edit-cover-photo"),u=this.appContext.viewportData.getDevicePixelRatio();(i=new e.Views.FluidModal({appContext:s.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:s.appContext,links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],enableSearch:!0}),actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!0,subview:new e.Views["photo-selector-view"]({appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1},defaultSelected:{id:s.albumId,title:s.get("albumModel").getValue("title"),type:"set"}}),width:752,height:498,fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1})).on("actionClick",function(t){d.replace(r);var h=i.get("subview").get("selected");this.appContext.getModel("photo-models",h).then(function(e){return(n=!1===l.hasPhoto(h)?l.registry.remote.addPhoto({setID:s.albumId,photoID:h},s.appContext).then(function(){return s.fire("subviewViewEvent","newPhotoAddedToAlbum",h),l.registry.remote.setPrimaryPhoto({photoId:h,albumId:s.albumId},s.appContext)}):l.registry.remote.setPrimaryPhoto({photoId:h,albumId:s.albumId},s.appContext)).then(function(t){a=e.getSizeToFit({width:.8*s.appContext.viewportData.getWidth()*u,height:(s.getAlbumHeaderHeight()-60)*u}),l.setValue("primary",e.id),l.setValue("primaryPhotoSizes",e.getValue("sizesForAlbum")),l.setValue("primaryNeedsInterstitial",e.getValue("needsInterstitial")),a&&o.one(".album-header-content").setStyle("background-image","url("+a.url+")"),o.one(".balls").replace(d)})}).then(null,function(t){new e.Views.FluidModal({title:s.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:s.intlMessage({intlName:"common.OK"}),textMessage:s.intlMessage({intlName:"album-page.ERROR_COVER_PHOTO"}),appContext:s.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0}).show(),o.one(".balls").replace(d)})}),i.registerEventHandler(e.on("photoSelector:selected",function(e){i.enableActionButton()})),i.registerEventHandler(e.on("photoSelector:unselected",function(e){i.disableActionButton()})),e.rapidTracker.beacon(s.name,"albumCoverPhotoEdit"),i.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-header","hermes-template-flickr-balls"],optional:["album-title-desc-view","album-stats-view","album-engagement-view","photo-selector-view","fluid-modal-nav-bar-view","photo-list-photo-interaction-view","attribution-view"],langBundles:["album-page","global-nav","common"]});YUI.add("album-page-view",function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.albumId=t.albumId,this.isOwner=t.isOwner,this.isTwitterbot=t.isTwitterbot,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,t.id=t.albumId,t.modelRegistryName="set-models",t.maxNumAttrName="totalCount",this.pageParams=t.pageParams,t.photoListConfig={modelParams:{registryName:"set-models",modelIdOrAttributes:t.albumId,collectionAttributeName:"photoPageList"},parentName:this.name,pageParams:t.pageParams,contextSuffix:"album-"+t.albumId,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:t.withPhotoId},t.photoListConfig.layout={targetRowHeight:"justified"===this.albumPhotoListLayoutStyle?190:430,fullWidthBreakoutRowCadence:"justified"===this.albumPhotoListLayoutStyle?null:3,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:4,right:0,bottom:4,left:0},itemSpacing:{horizontal:4,vertical:4}},this.aftHelper=new e.PhotolistAftHelper(this),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"album-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,disabled:function(){return!this.pageParams.viewPageSize}},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("set-models",this.albumId).then(function(t){e.set("albumModel",t)})},buildContainer:function(){return this.setContainerWithTemplate("album-page"),this},buildHeadContainer:function(){var t,a,o,r,l=this.get("albumModel"),s=l.getValue("photoPageList").getList(),n="summary",u=[],h=(this.pageParams.nominalPage-1)*this.pageParams.viewPageSizeForShare||0;if(this.isTwitterbot&&s.length-h>=4)for(n="gallery",o=0;o<Math.min(s.length-h,4);o++)if(s[h+o]){var m=s[h+o].getSizeToFit({width:640,height:640});m&&m.url&&u.push({property:"twitter:image"+o,content:m.url})}else i.error("Missing album photo in album list",{index:h+o});l.registry?t=l.registry.getSizeToFit(this.albumId,{width:640,height:640}):i.error("Missing album model registry"),r=l.getValue("url").replace(/\/albums\/([0-9]+)/i,"/sets/$1"),a=this.templates("dynamic-page-head")({title:l.getValue("title"),description:l.getValue("description")||this.intlMessage({intlName:"album-page.OPENGRAPH_DESCRIPTION",owner:l.getValue("owner").getValue("displayname")}),url:l.getValue("url"),fullURL:e.url(r),openGraphImageURL:t?e.URLHelper.addProtocolToURL(t.url):"",openGraphaImageWidth:t?t.width:"",openGraphaImageHeight:t?t.height:"",ownerURL:l.getValue("owner").getValue("url"),twitterCardType:n,twitterImages:u,ogType:"article",domain:e.url(),feeds:[{title:this.intlMessage({intlName:"meta.ALBUM_ATOM_TITLE",username:l.getValue("owner").getValue("displayname"),albumTitle:l.getValue("title")}),url:"/services/feeds/photoset.gne?nsid="+l.getValue("owner").getValue("nsid")+"&set="+l.getValue("id")+"&lang="+this.appContext.lang.toLowerCase()+"&format=atom"}]}),a+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),a+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),a+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",a):(this.set("headContainer",a.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},activate:function(){var t=this,i=this.get("albumModel"),a=i.getValue("isOwner");return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),e.on("albumToolbarView:layoutChange",function(e){var i=t.subviews["photo-list-view"],a=i.photoListLayout;a.targetRowHeight="justified"===e?190:430,a.fullWidthBreakoutRowCadence="justified"===e?null:3,i.setItems(t.get("albumModel").getValue("photoPageList").getList())}),a||this.appContext.getViewCounter().recordAlbumView({albumOwnerID:i.getValue("owner").getValue("id"),albumID:i.getValue("id"),referrer:this.appContext.getReferrer()}),this},onSubviewEvent:function(e,t){t&&"newPhotoAddedToAlbum"===t[0]&&this.subviews["photo-list-view"].setItems(this.get("albumModel").getValue("photoPageList").getList())},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("albumModel").getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,vwrOwner:this.isOwner?1:0}}},{ATTRS:{spaceid:{value:792600538}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","set-models","hermes-template-album-page","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-head-link","album-toolbar-view","album-header-view","photo-list-view","footer-full-view","photolist-aft-helper","url-helper"],langBundles:["album-page","meta"]});