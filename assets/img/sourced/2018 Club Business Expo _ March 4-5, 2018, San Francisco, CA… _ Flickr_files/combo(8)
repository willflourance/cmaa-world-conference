YUI.add("flickr-groups-pools-add-creator",function(o,e){"use strict";o.namespace("ModelCreators")["flickr-groups-pools-add"]={run:function(t,r){var p=this,s=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.add",s),groupPoolModel:r.getModel(l,t.groupID),photoModel:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModel=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return p._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModel,p=o.photoModel,s=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,u=o.unfilteredGroupPoolModel;if("ok"===t.stat)return r&&!r.hasPhoto(p.getValue("id"))&&(r.addPhotoLocal(p),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1)),u&&u.hasPhoto(p.getValue("id"))&&u.addPhotoLocal(p),s.exists(e.photoID)&&!s.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(s.getValue(e.photoID,"groups").unshift(r),s.setValue(e.photoID,"total",s.getValue(e.photoID,"total")+1)),l.exists(e.photoID)&&!l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")+1),l.getValue(e.photoID,"contexts").push(r)),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-pools-remove-deletor",function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-groups-pools-remove"]={run:function(t,r){var s=this,p=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.remove",p),groupPoolModelRegistry:r.getModel(l,t.groupID),photoModelRegistry:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=p.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModelRegistry=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return s._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModelRegistry,s=o.photoModelRegistry,p=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,u=o.unfilteredGroupPoolModelRegistry;if("ok"===t.stat)return l.exists(e.photoID)&&l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")-1),l.getValue(e.photoID,"contexts").removeFromList(e.unfilteredGroupId)),p.exists(e.photoID)&&p.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(p.setValue(e.photoID,"total",p.getValue(e.photoID,"total")-1),p.getValue(e.photoID,"groups").removeFromList(e.unfilteredGroupId)),r&&(r.hasPhoto(s.getValue("id"))&&r.removePhotoLocal(s),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")-1)),u&&u.hasPhoto(s.getValue("id"))&&u.removePhotoLocal(s),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-invite-creator",function(o,t){"use strict";o.namespace("ModelCreators")["flickr-groups-invite-photo-invite"]={run:function(e,i){var r={},p=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return r.photo_id=e.photoID,r.group_id=p,o.Promise.all([i.callAPI("flickr.groups.invite.photo.invite",r),i.getModel("group-pool-models",p),i.getModelRegistry("photo-group-invitation-models"),i.getModelRegistry("photo-group-invitations-models")]).then(function(o){var t,r,n,s=o[0],l=o[1],u=o[2],d=o[3];if("ok"===s.stat)return t=[e.photoID,p].join("-"),r={id:t,photoId:e.photoID,groupId:p,invitedBy:i.getViewer().nsid},n=u.exists(t)?u.proxy(t):u.add(r),d.exists(e.photoID)&&!d.getValue(e.photoID,"invitations").getFromListByID(t)&&(d.getValue(e.photoID,"groups").prependToList(l),d.getValue(e.photoID,"invitations").prependToList(n),d.setValue(e.photoID,"total",d.getValue(e.photoID,"total")+1)),l},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-cancel-deletor",function(o,t){"use strict";o.namespace("ModelDeletors")["flickr-groups-invite-photo-cancel"]={run:function(e,r){var i={},l=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return i.photo_id=e.photoID,i.group_id=l,o.Promise.all([r.callAPI("flickr.groups.invite.photo.cancel",i),r.getModel("group-pool-models",l),r.getModelRegistry("photo-group-invitation-models"),r.getModelRegistry("photo-group-invitations-models")]).then(function(o){var t,r=o[0],i=o[1],p=o[2],s=o[3];if("ok"===r.stat)return t=[e.photoID,l].join("-"),s.exists(e.photoID)&&s.getValue(e.photoID,"invitations").getFromListByID(t)&&(s.setValue(e.photoID,"total",s.getValue(e.photoID,"total")-1),s.getValue(e.photoID,"groups").removeFromList(l),s.getValue(e.photoID,"invitations").removeFromList(t)),p.remove(t),i},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-pool-by-person-models",function(e){function o(e){o.superclass.constructor.call(this,e)}e.Models[this.name]=o,e.extend(o,e.Models["group-pool-models"],{name:this.name,attributes:e.merge(e.Models["group-pool-models"].prototype.attributes,{personFilter:{validator:function(o,r){return e.AttributeHelpers.validateString(o)},setter:function(o){return e.AttributeHelpers.coerceString(o)},defaultValue:null}})})},"@VERSION@",{requires:["attribute-helpers","group-pool-models","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor"]});YUI.add("group-pool-by-tag-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.Models["group-pool-models"],{name:this.name,attributes:{tagFilter:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:null}}})},"@VERSION@",{requires:["attribute-helpers"]});YUI.add("flickr-groups-pools-getPhotos-fetcher",function(o,e){"use strict";o.namespace("ListFetchers")["flickr-groups-pools-getPhotos"]={run:function(t,r){var s=this,p=this._processParams(t),l={apiResponse:r.callAPI("flickr.groups.pools.getPhotos",p,!0),photoModelRegistry:r.getModelRegistry("photo-models"),personModelRegistry:r.getModelRegistry("person-models"),groupPoolModelRegistry:r.getModelRegistry("group-pool-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:r.getModelRegistry("photo-stats-models"),groupModelRegistry:r.getModelRegistry("group-models")};return t.personFilter&&(l.groupPoolByPersonModelRegistry=r.getModelRegistry("group-pool-by-person-models")),t.tagFilter&&(l.groupPoolByTagModelRegistry=r.getModelRegistry("group-pool-by-tag-models")),new o.FlickrPromise(l).then(function(o){return s._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){var t={extras:o.APIHelper.request.getRebootPhotoExtras()+","+o.APIHelper.request.getRebootGroupExtras(),per_page:e.perPage||20,page:e.page||1,get_group_info:1};if(e.id)t.group_id=o.Models["group-pool-models"].extractGroupFromCompoundId(e.id);else{if(!e.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=e.pathAlias}return e.withPhotoId&&(t.jump_to=e.withPhotoId),e.privacyFilter&&(t.privacy_filter=e.privacyFilter),e.safeSearch&&(t.safe_search=e.safeSearch),e.media&&(t.media=e.media),e.personFilter&&(t.user_id=e.personFilter),e.tagFilter&&(t.tags=e.tagFilter),t},_processResponse:function(e,t){var r,s,p,l,i=e.apiResponse,g=e.photoModelRegistry,a=e.personModelRegistry,d=e.groupPoolModelRegistry,u=e.groupPoolByPersonModelRegistry,n=e.groupPoolByTagModelRegistry,h=e.photoEngagementModelRegistry,m=e.photoStatsModelRegistry,y=e.groupModelRegistry;return i.group.pathAlias=""===i.group.pathalias?null:i.group.pathalias,r=y.parseGroupModel(i.group.nsid,i.group.pathAlias,i.group),y.addOrUpdate(r),s={pathAlias:i.group.pathAlias,group:y.proxy(r.id),filteredPoolCount:i.group.poolCount},p=o.APIHelper.response.parsePhotos({photos:i.photos.photo,personModelRegistry:a,photoModelRegistry:g,photoEngagementModelRegistry:h,photoStatsModelRegistry:m}),s.photoPageList={perPage:i.photos.perpage,page:i.photos.page,pageContent:p,totalItems:s.filteredPoolCount},t.personFilter?(s.id=o.Models["group-pool-models"].buildCompoundId(i.group.nsid,t.personFilter),s.personFilter=t.personFilter,s.filteredPoolCount=s.photoPageList.totalItems=i.photos.total,l=u):t.tagFilter?(s.id=o.Models["group-pool-models"].buildCompoundId(i.group.nsid,t.tagFilter),s.tagFilter=t.tagFilter,s.filteredPoolCount=s.photoPageList.totalItems=i.photos.total,l=n):(t.id&&t.id!==i.group.nsid?s.id=t.id:s.id=i.group.nsid,l=d),l.exists(s.id)?(l.setValue(s.id,"photoPageList",s.photoPageList),l.setValue(s.id,"group",s.group),l.setValue(s.id,"pathAlias",s.pathAlias),l.setValue(s.id,"filteredPoolCount",parseInt(s.filteredPoolCount,10)||0),s.group.setValue("poolCount",parseInt(i.group.poolCount,10)||0)):l.add(s),p}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photo-engagement-models","photo-stats-models","group-models","group-pool-models","group-pool-by-person-models","group-pool-by-tag-models"]});YUI.add("group-contributor-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},dateJoined:{validator:function(e){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")}},groupDiscussionCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},groupPhotoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},pathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},rank:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},realname:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},username:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoTitle:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},avatarUrl:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(t,e){return!!this.getValue(e,"latestPhotoId")&&this.getValue(e,"contributorUrl")+this.getValue(e,"latestPhotoId")+"/"}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(t,e){return this.getValue(e,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(t,e){return"/photos/"+(this.getValue(e,"pathAlias")||this.getValue(e,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(e){return t.AttributeHelpers.coerceBoolean(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});YUI.add("flickr-groups-getTopContributors-fetcher",function(o,r){"use strict";function t(r,t){var e={id:r.id+"-"+t,nsid:r.id,dateJoined:r.dateJoined?o.moment(r.dateJoined.toString(),"X"):o.moment(),groupDiscussionCount:r.groupDiscussionCount,groupPhotoCount:r.groupPhotoCount,pathAlias:r.pathAlias,rank:r.rank,realname:r.realname,username:r.username,isPro:r.isPro,avatarUrl:o.URLHelper.getBuddyIconURL(r.id,r.iconfarm,r.iconserver)};return r.latestPhoto&&(e.latestPhotoId=r.latestPhoto.id,e.latestPhotoTitle=r.latestPhoto.name),e}o.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:function(t,e){var i=this;return o.Promise.all([e.callAPI("flickr.groups.getTopContributors",this._processParams(t),!0),e.getModelRegistry("group-top-contributors-models"),e.getModelRegistry("group-contributor-models")]).then(function(o){return i._processResponse(o,t)},o.FetcherErrorLogger(r))},_processParams:function(o){return{group_id:o.id,type:"all",extras:"include_viewer,is_pro"}},_processResponse:function(o,r){var e,i,s,n=o[0],u=o[1],a=o[2];return i={photoContributors:[],discussionContributors:[],id:r.id},n&&n.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach(function(o){n.contributors[o.k]&&(e=n.contributors[o.k]).contributor&&e.contributor.forEach(function(e){s=t(e,r.id),i[o.v].push(a.addOrUpdate(s))})}),n&&n.viewer&&0!==n.viewer.length?(s=t(n.viewer,r.id),i.viewer=a.addOrUpdate(s)):i.viewer=null,u.addOrUpdate(i),u.proxy(i.id)}}},"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]});YUI.add("group-top-contributors-models",function(t){function r(t){r.superclass.constructor.call(this,t)}t.Models[this.name]=r,t.extend(r,t.FlickrModelRegistry,{name:this.name,remote:{read:function(r){var o=this;return t.ModelFetchers["flickr-groups-getTopContributors"].run(r,this.appContext).then(function(t){return o})}},attributes:{viewer:{isModel:!0,defaultValue:null},contributors:{isCollection:!0},photoContributors:{isCollection:!0},discussionContributors:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getTopContributors-fetcher","attribute-helpers"]});YUI.add("group-pool-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-groups-pools-getPhotos"].run(e,this.appContext)},addPhoto:function(e,o){return e.registryName=this.name,t.ModelCreators["flickr-groups-pools-add"].run(e,o)},removePhoto:function(e,o){return e.registryName=this.name,t.ModelDeletors["flickr-groups-pools-remove"].run(e,o)},invitePhoto:function(e,o){return t.ModelCreators["flickr-groups-invite-photo-invite"].run(e,o)},cancelPhotoInvitation:function(e,o){return t.ModelDeletors["flickr-groups-invite-photo-cancel"].run(e,o)}},addPhotoLocal:function(t,e){return this.getValue(t,"photoPageList").unshift(e),this.getValue(t,"photoContextList").hasMaxBoundary()&&this.getValue(t,"photoContextList").appendToList(e),this},addPhotoRemote:function(t,e){return this.remote.addPhoto.call(this,{photoID:e,groupID:t},this.appContext)},removePhotoLocal:function(t,e){return this.getValue(t,"photoPageList").removeFromList(e.getValue("id")),this.getValue(t,"photoContextList").removeFromList(e.getValue("id")),this},removePhotoRemote:function(t,e){return this.remote.removePhoto.call(this,{photoID:e,groupID:t},this.appContext)},invitePhotoRemote:function(t,e){return this.remote.invitePhoto.call(this,{photoID:e,groupID:t},this.appContext)},cancelPhotoInvitationRemote:function(t,e){return this.remote.cancelPhotoInvitation.call(this,{photoID:e,groupID:t},this.appContext)},hasPhoto:function(t,e){return this.getValue(t,"photoPageList").getFromListByID(e)||this.getValue(t,"photoContextList").getFromListByID(e)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"group"}},pathAlias:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultFn:function(t){return t}},photoPageList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-groups-pools-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:t.ListFetchers["flickr-groups-pools-getContext"],listItemIdField:"photoId"}},group:{isModel:!0},urlSuffix:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(t){var e=this.getValue(t,"pathAlias");return e||(e=t),"pool-"+e}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("url")}},title:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("title")}},poolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("poolCount")}},filteredPoolCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultFn:function(t){return this.getValue(t,"group").getValue("poolCount")}},friendlyPoolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("friendlyPoolCount")}}}},{buildCompoundId:function(t,e){return t+"-"+e},extractGroupFromCompoundId:function(t){return t.split("-")[0]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getContext-fetcher","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor","attribute-helpers"],optional:["group-top-contributors-models"]});YUI.add("flickr-groups-pools-getGroups-fetcher",function(e,r){"use strict";e.namespace("ListFetchers")["flickr-groups-pools-getGroups"]={run:function(s,o){var p=this;return e.Promise.all([o.callAPI("flickr.groups.pools.getGroups",{extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, needs_interstitial",page:s.page||0,per_page:s.perPage||400},!0),o.getModelRegistry("person-groups-models"),o.getModelRegistry("group-pool-models"),o.getModelRegistry("group-models")]).then(function(e){return p._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(r,s){var o=r[0],p=r[1],u=r[2],t=r[3],i=o.groups,a=s.id,l={},g=[];if(i)return i.group&&e.Array.each(i.group,function(e,r){var s,o,p;p=t.parseGroupModel(e.id,e.pathAlias,e),s=t.addOrUpdate(p),o=u.addOrUpdate({id:e.id,pathAlias:e.pathAlias,group:s}),g.push(o)}),l={id:a,memberCount:o.userGroupMemberships?o.userGroupMemberships.member:null,moderatorCount:o.userGroupMemberships?o.userGroupMemberships.moderator:null,adminCount:o.userGroupMemberships?o.userGroupMemberships.admin:null,invitedCount:o.userGroupMemberships?o.userGroupMemberships.invited:null},l.groups=e.APIHelper.response.addOrReplaceListByPage({current:p.exists(a)?p.proxy(a).getValue("groups").getList():[],perPage:s.perPage,pageNum:s.page,totalItems:o.groups.total,newPages:g}),p.exists(a)?p.setValue(a,"groups",l.groups):p.add(l),l.groups}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models","group-pool-models","person-models"]});YUI.add("flickr-groups-fave-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-groups-fave"]={run:function(s,o){return e.Promise.all([o.callAPI("flickr.groups.fave",s),o.getModelRegistry("person-groups-models")]).then(this._processResponse,e.FetcherErrorLogger(r))},_processResponse:function(e){}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});YUI.add("flickr-groups-unfave-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-groups-unfave"]={run:function(s,o){return e.Promise.all([o.callAPI("flickr.groups.unfave",s),o.getModelRegistry("person-groups-models")]).then(this._processResponse,e.FetcherErrorLogger(r))},_processResponse:function(e){}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});YUI.add("flickr-people-getGroupsWithStatus-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-people-getGroupsWithStatus"]={run:function(s,i){var r=this,o={extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, date_activity, date_last_viewed",user_id:s.id,status:s.status};return s.id!==i.getViewer().nsid&&(o.public_only=1,o.status="2,3,4"),e.Promise.all([i.callAPI("flickr.people.getGroupsWithStatus",o,!0),i.getModelRegistry("person-groups-models"),i.getModelRegistry("group-models"),i.getModelRegistry("group-activity-models")]).then(function(e){return r._processResponse(e,s)},e.FetcherErrorLogger(t))},_processResponse:function(t,s){var i,r=t[0],o=t[1],a=t[2],u=t[3],d=r.groups,l=s.id,p={},n=[];if(d)return e.Array.each(d,function(t,r){var o,d,l,p=a.parseGroupModel(s.id,s.pathAlias,t);o=a.addOrUpdate(p),n.push(o),t.viewDates?(d="0"!==t.viewDates.pool?e.moment(t.viewDates.pool,"X"):u.getDefaultViewedDate(),(l="0"!==t.viewDates.discussions?e.moment(t.viewDates.discussions,"X"):u.getDefaultViewedDate()).isValid()||(l=u.getDefaultViewedDate()),d.isValid()||(d=u.getDefaultViewedDate())):(d=u.getDefaultViewedDate(),l=u.getDefaultViewedDate()),i={id:p.id,viewedPool:d,viewedDiscussions:l,group:o},u.addOrUpdate(i)}),p={id:l,memberCount:r.members?r.members:null,moderatorCount:0,adminCount:0,invitedCount:0},p[s.attribute]=n,o.exists(l)?o.setValue(l,s.attribute,p[s.attribute]):o.add(p),p[s.attribute]}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models"]});YUI.add("person-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},faveGroup:function(t,r){return e.ModelFetchers["flickr-groups-fave"].run(t,r)},unfaveGroup:function(t,r){return e.ModelFetchers["flickr-groups-unfave"].run(t,r)}},faveGroup:function(e){var t=this,r=e.group_id,o=e.user_id;return this.remote.faveGroup(e,this.appContext).then(null,function(){t.appContext.getModel("group-models",r).then(function(e){t.getValue(o,"groupsFaved").removeFromList(r)})}),this.appContext.getModel("group-models",r).then(function(e){t.getValue(o,"groupsFaved").appendToList(e)})},unfaveGroup:function(e){var t=e.group_id,r=e.user_id,o=this;return this.remote.unfaveGroup(e,this.appContext).then(null,function(){o.appContext.getModel("group-models",t).then(function(e){o.getValue(r,"groupsFaved").appendToList(e)})}),this.appContext.getModel("group-models",t).then(function(e){o.getValue(r,"groupsFaved").removeFromList(t)})},attributes:{id:{},memberCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},moderatorCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},adminCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},invitedCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},groups:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getGroups"]}},groupsAdministered:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsModerated:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsBelongingTo:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsFaved:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getGroups-fetcher","flickr-people-getInfo-fetcher","flickr-groups-fave-fetcher","flickr-groups-unfave-fetcher","flickr-people-getGroupsWithStatus-fetcher"]});YUI.add("flickr-photos-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photos.getContext",this._processParams(t,s),!0),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o,t){var s;return s={photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()},o.viewAs&&(s.view_as=o.viewAs),o.orderBy&&(s.order_by=o.orderBy),s},_processResponse:function(o,t){var s,r,n,p,a,i,h=o[0],l=o[1],d=o[2],g=o[3],u=o[4],m=[],c=[],x=d.proxy(t.photoId),y=x.getValue("owner"),M=[];return s=h.prevphotos,r=h.nextphotos,c=e.APIHelper.response.parsePhotos({photos:s.photo,existingPerson:y,photoModelRegistry:d,photoEngagementModelRegistry:g,photoStatsModelRegistry:u}),m=e.APIHelper.response.parsePhotos({photos:r.photo,existingPerson:y,photoModelRegistry:d,photoEngagementModelRegistry:g,photoStatsModelRegistry:u}),p=l.getValue(t.id,"photoContextList"),a=!!p.hasMinBoundary&&p.hasMinBoundary(),i=!!p.hasMaxBoundary&&p.hasMaxBoundary(),n=p.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:x,next:c,prev:m.reverse(),hasMin:a,hasMax:i,current:n,numNext:t.numNext,numPrev:t.numPrev}),l.setValue(t.id,"photoContextList",M),{next:c,previous:m.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photos-getPerms-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:function(s,i){var o={photo_id:s.id},t=this;return e.Promise.all([i.callAPI("flickr.photos.getPerms",o),i.getModelRegistry("photo-privacy-models")]).then(function(e){return t._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s,i=e[0],o=e[1];s={id:r.id,isPublic:i.perms.ispublic,isVisibleByFriends:i.perms.isfriend,isVisibleByFamily:i.perms.isfamily,permAddMeta:i.perms.permaddmeta,permComment:i.perms.permcomment},o.addOrUpdate(s)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});